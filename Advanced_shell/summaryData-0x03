#!/usr/bin/env bash
# Advanced_shell / summaryData-0x03
# Generate a CSV report summarizing data for multiple Pokémon

set -Eeuo pipefail

# Folder where Pokémon data is stored (from Task 2)
INPUT_DIR="pokemon_data"
OUTPUT_CSV="pokemon_report.csv"

# Create CSV file with headers
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_CSV"

# Initialize variables for calculating averages
total_height=0
total_weight=0
pokemon_count=0

# Loop through all JSON files in the pokemon_data directory
for json_file in "$INPUT_DIR"/*.json; do
  # Extract the name, height, and weight for each Pokémon
  name=$(jq -r '.name' "$json_file" | awk '{print toupper(substr($0,1,1)) tolower(substr($0,2))}')
  height=$(jq -r '.height' "$json_file" | awk '{printf "%.1f", $1/10}')
  weight=$(jq -r '.weight' "$json_file" | awk '{printf "%.1f", $1/10}')

  # Append the data to the CSV file
  echo "$name,$height,$weight" >> "$OUTPUT_CSV"

  # Update the totals for averages
  total_height=$(echo "$total_height + $height" | bc)
  total_weight=$(echo "$total_weight + $weight" | bc)
  pokemon_count=$((pokemon_count + 1))
done

# Calculate the averages using awk
average_height=$(echo "$total_height / $pokemon_count" | bc -l)
average_weight=$(echo "$total_weight / $pokemon_count" | bc -l)

# Append the averages to the CSV file
echo >> "$OUTPUT_CSV"
echo "Average Height: $average_height m" >> "$OUTPUT_CSV"
echo "Average Weight: $average_weight kg" >> "$OUTPUT_CSV"

# Output message
echo "CSV Report generated at: $OUTPUT_CSV"
